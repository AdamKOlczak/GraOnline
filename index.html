<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>KÃ³Å‚ko i krzyÅ¼yk multiplayer</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; }
    #board { display: grid; grid-template-columns: repeat(3, 100px); gap: 5px; margin: 20px auto; }
    .cell { width: 100px; height: 100px; background: #eee; font-size: 72px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
    .cell.disabled { cursor: default; color: #aaa; }
    #status { margin-top: 20px; font-size: 20px; }
    #gameIdInput { width: 120px; font-size: 16px; }
  </style>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>

  <h1>KÃ³Å‚ko i krzyÅ¼yk online</h1>

  <button id="btnNewGame">Nowa gra</button>
  <input type="text" id="gameIdInput" placeholder="Kod gry" maxlength="6" />
  <button id="btnJoinGame">DoÅ‚Ä…cz do gry</button>

  <div id="status">Wpisz kod gry lub zacznij nowÄ…</div>

  <div id="board"></div>

<script>
  // --------------------- TU WPISZ KONFIGURACJÄ˜ FIREBASE ---------------------

  const firebaseConfig = {
    apiKey: "AIzaSyATOiD3Hp077WyGNi50KFTCxx_yrmuyxf0",
    authDomain: "gratest-cfc14.firebaseapp.com",
    databaseURL: "https://gratest-cfc14-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "gratest-cfc14",
    storageBucket: "gratest-cfc14.firebasestorage.app",
    messagingSenderId: "26328738989",
    appId: "1:26328738989:web:18484211ec540a9cf66a24"
  };


  // ---------------------------------------------------------------------------

  // Inicjalizacja Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // Globalne zmienne
  let gameId = null;
  let playerSymbol = null;  // "X" lub "O"
  let myTurn = false;
  let boardState = Array(9).fill(null);  // tablica 9 pÃ³l planszy

  const boardEl = document.getElementById('board');
  const statusEl = document.getElementById('status');
  const btnNewGame = document.getElementById('btnNewGame');
  const btnJoinGame = document.getElementById('btnJoinGame');
  const gameIdInput = document.getElementById('gameIdInput');

  // Tworzymy planszÄ™ w HTML
  function createBoard() {
    boardEl.innerHTML = '';
    for(let i=0; i<9; i++) {
      const cell = document.createElement('div');
      cell.classList.add('cell');
      cell.dataset.index = i;
      cell.addEventListener('click', () => makeMove(i));
      boardEl.appendChild(cell);
    }
  }

  createBoard();

  // Generuje losowy 6-znakowy kod gry (litery i cyfry)
  function generateGameId() {
    return Math.random().toString(36).substring(2,8).toUpperCase();
  }

  // Aktualizuj widok planszy
  function updateBoard() {
    for(let i=0; i<9; i++) {
      const cell = boardEl.querySelector(`[data-index="${i}"]`);
      cell.textContent = boardState[i] || '';
      if (!myTurn || boardState[i]) {
        cell.classList.add('disabled');
      } else {
        cell.classList.remove('disabled');
      }
    }
  }

  // Sprawdza, czy jest zwyciÄ™zca lub remis
  function checkWinner(board) {
    const lines = [
      [0,1,2], [3,4,5], [6,7,8],  // wiersze
      [0,3,6], [1,4,7], [2,5,8],  // kolumny
      [0,4,8], [2,4,6]            // przekÄ…tne
    ];
    for (const [a,b,c] of lines) {
      if (board[a] && board[a] === board[b] && board[a] === board[c]) {
        return board[a]; // "X" lub "O"
      }
    }
    if (board.every(cell => cell)) return 'draw';
    return null;
  }

  // Ruch gracza â€” prÃ³ba zapisania ruchu w bazie
  function makeMove(i) {
    if (!myTurn || boardState[i]) return;

    boardState[i] = playerSymbol;
    const winner = checkWinner(boardState);

    // Zapisz stan do Firebase
    db.ref('games/' + gameId).update({
      board: boardState,
      turn: playerSymbol === 'X' ? 'O' : 'X',
      winner: winner || null
    });
  }

  // NasÅ‚uchiwanie zmian w grze
  function listenToGame() {
    db.ref('games/' + gameId).on('value', snapshot => {
      const data = snapshot.val();
      if (!data) {
        statusEl.textContent = 'Gra nie istnieje lub zostaÅ‚a zakoÅ„czona.';
        return;
      }
      boardState = data.board || Array(9).fill(null);
      updateBoard();

      if (data.winner) {
        if (data.winner === 'draw') {
          statusEl.textContent = 'Remis! ðŸŽ‰';
        } else {
          statusEl.textContent = data.winner === playerSymbol ? 'WygraÅ‚eÅ›! ðŸŽ‰' : 'PrzegraÅ‚eÅ› :(';
        }
        myTurn = false;
      } else {
        myTurn = (data.turn === playerSymbol);
        statusEl.textContent = myTurn ? 'Twoja tura!' : 'Tura przeciwnika...';
      }
    });
  }

  // Start nowej gry
  btnNewGame.addEventListener('click', () => {
    gameId = generateGameId();
    playerSymbol = 'X';
    myTurn = true;
    boardState = Array(9).fill(null);

    db.ref('games/' + gameId).set({
      board: boardState,
      turn: 'X',
      winner: null
    });

    listenToGame();

    statusEl.textContent = `Nowa gra utworzona. Kod gry: ${gameId}. Czekaj na przeciwnika.`;
  });

  // DoÅ‚Ä…czanie do gry
  btnJoinGame.addEventListener('click', () => {
  const inputId = gameIdInput.value.trim().toUpperCase();
  if (!inputId) {
    alert('Podaj kod gry!');
    return;
  }
  db.ref('games/' + inputId).once('value').then(snapshot => {
    const data = snapshot.val();
    if (!data) {
      alert('Nie ma takiej gry!');
      return;
    }
    if (data.winner) {
      alert('Gra juÅ¼ zakoÅ„czona.');
      return;
    }
    gameId = inputId;
    playerSymbol = 'O';  // DoÅ‚Ä…czajÄ…cy zawsze O
    listenToGame();
    myTurn = (data.turn === playerSymbol);
    statusEl.textContent = `DoÅ‚Ä…czyÅ‚eÅ› do gry ${gameId}. Tura gracza ${data.turn}.`;
  });
});

</script>

</body>
</html>
