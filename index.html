<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Przycisk na zmianę - multiplayer z wyborem gracza</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin-top: 50px; }
    #colorButton {
      width: 150px; height: 150px; font-size: 24px; border: none; cursor: pointer;
      color: white; border-radius: 12px; margin-top: 20px;
    }
    #status {
      margin-top: 20px; font-size: 18px;
    }
    #choosePlayer {
      margin-top: 30px;
    }
    button.playerBtn {
      padding: 10px 20px;
      font-size: 18px;
      margin: 0 10px;
      cursor: pointer;
    }
  </style>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>

  <h1>Przycisk na zmianę - multiplayer</h1>

  <div id="choosePlayer">
    <button class="playerBtn" id="btnPlayer1">Dołącz jako Gracz 1 (Czerwony)</button>
    <button class="playerBtn" id="btnPlayer2">Dołącz jako Gracz 2 (Zielony)</button>
  </div>

  <button id="colorButton" disabled>Ładuję...</button>

  <div id="status">Wybierz gracza, aby rozpocząć</div>

  <script>
    // Konfiguracja Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyATOiD3Hp077WyGNi50KFTCxx_yrmuyxf0",
      authDomain: "gratest-cfc14.firebaseapp.com",
      databaseURL: "https://gratest-cfc14-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "gratest-cfc14",
      storageBucket: "gratest-cfc14.firebasestorage.app",
      messagingSenderId: "26328738989",
      appId: "1:26328738989:web:18484211ec540a9cf66a24"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const btnPlayer1 = document.getElementById('btnPlayer1');
    const btnPlayer2 = document.getElementById('btnPlayer2');
    const colorButton = document.getElementById('colorButton');
    const statusEl = document.getElementById('status');
    const choosePlayerDiv = document.getElementById('choosePlayer');

    let playerId = null;  // "player1" lub "player2"
    let currentColor = null;  // 'red' lub 'green'
    let currentTurn = null;   // 'player1' lub 'player2'

    // Referencja do stanu gry
    const gameRef = db.ref('simpleGame');

    // Inicjalizacja gry (jeśli nie ma stanu)
    function initGameIfNeeded() {
      gameRef.once('value').then(snapshot => {
        if (!snapshot.exists()) {
          gameRef.set({
            color: 'red',      // start z czerwonym
            turn: 'player1'    // start tury player1
          });
        }
      });
    }

    initGameIfNeeded();

    // Nasłuchiwanie zmian stanu
    gameRef.on('value', snapshot => {
      const data = snapshot.val();
      if (!data) return;

      currentColor = data.color;
      currentTurn = data.turn;

      // Ustaw kolor przycisku
      colorButton.style.backgroundColor = currentColor;

      if (!playerId) {
        statusEl.textContent = "Wybierz gracza, aby rozpocząć";
        colorButton.disabled = true;
        return;
      }

      if (currentTurn === playerId) {
        statusEl.textContent = "Twoja tura! Kliknij przycisk";
        colorButton.disabled = false;
      } else {
        statusEl.textContent = `Tura przeciwnika (${currentTurn})`;
        colorButton.disabled = true;
      }
    });

    // Kliknięcie przycisku
    colorButton.addEventListener('click', () => {
      if (currentTurn !== playerId) return;

      // Zmiana koloru: czerwony = player1, zielony = player2
      const newColor = (currentColor === 'red') ? 'green' : 'red';
      const nextTurn = (currentTurn === 'player1') ? 'player2' : 'player1';

      gameRef.update({
        color: newColor,
        turn: nextTurn
      });
    });

    // Dołączanie jako player1
    btnPlayer1.addEventListener('click', () => {
      playerId = 'player1';
      choosePlayerDiv.style.display = 'none';
      colorButton.disabled = true;
      statusEl.textContent = 'Dołączyłeś jako Gracz 1 (Czerwony). Czekaj na swoją turę...';
    });

    // Dołączanie jako player2
    btnPlayer2.addEventListener('click', () => {
      playerId = 'player2';
      choosePlayerDiv.style.display = 'none';
      colorButton.disabled = true;
      statusEl.textContent = 'Dołączyłeś jako Gracz 2 (Zielony). Czekaj na swoją turę...';
    });
  </script>

</body>
</html>
